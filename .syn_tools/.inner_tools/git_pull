#!/bin/bash
echo "running script $0..."


echo "\$0:$0"
echo "\$1:$1"
targetDir="$1"

get_current_date (){
	echo $(date '+%Y-%m-%d %H:%M:%S')
}

push_stash () {
	echo "git stash push..." 
	git stash push
}

pop_stash () {
	echo "git stash pop..." 
	git stash pop
}

# batch_sh æ‰¹é‡åŒæ­¥å‘½ä»¤ï¼ˆç»™crontabç”¨ï¼‰
stash_and_pull(){
	echo "git stash push..."
	git add *
	git add .
	git rm $(git ls-files --deleted)
	git stash push
	echo "git pull..."
	git pull
	echo "git stash pop..."
	git stash pop
}

exit_if_target_dir_not_exit () {
	echo "exit_if_target_dir_not_exit..."
	dir=$1
	if [ ! -d "$dir" ]; then
  		echo "ç›®å½•($dir)ä¸å­˜åœ¨ï¼Œå³å°†é€€å‡ºå¤„ç†..."
  		exit -1
	fi
}



main () {
	exit_if_target_dir_not_exit "$targetDir"

	echo "---------------ğŸ”»ğŸ”»ğŸ”»ğŸ”»ğŸ”» ç›®æ ‡ä»“åº“ï¼š$targetDir ğŸ”»ğŸ”»ğŸ”»ğŸ”» ----------------"

	echo "---------------ğŸ”»ğŸ”»ğŸ”»ğŸ”»ğŸ”» pull å¼€å§‹æ‰§è¡Œ[$(get_current_date)] ğŸ”»ğŸ”»ğŸ”»ğŸ”» ----------------"

	cd "$targetDir"
	stash_and_pull

	echo "---------------ğŸ”»ğŸ”»ğŸ”»ğŸ”»ğŸ”» ç›®æ ‡ä»“åº“ï¼š$targetDir ğŸ”»ğŸ”»ğŸ”»ğŸ”» ----------------"
	echo  "--------------- ğŸ”»ğŸ”»ğŸ”»ğŸ”» pull æ‰§è¡Œç»“æŸæ—¶é—´[$(get_current_date)] ğŸ”»ğŸ”»ğŸ”»ğŸ”» ----------------"
	echo ""
}


# =============== main =============== 
main
# =============== main =============== 

